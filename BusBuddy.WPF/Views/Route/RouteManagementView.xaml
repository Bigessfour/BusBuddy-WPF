<UserControl x:Class="BusBuddy.WPF.Views.Route.RouteManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:BusBuddy.WPF.ViewModels"
             xmlns:models="clr-namespace:BusBuddy.Core.Models;assembly=BusBuddy.Core"
             xmlns:sf="http://schemas.syncfusion.com/wpf"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:tools="http://schemas.syncfusion.com/wpf"
             xmlns:viewModels="clr-namespace:BusBuddy.WPF.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance viewModels:RouteManagementViewModel}">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Enhanced Route Status Templates -->
        <DataTemplate x:Key="RouteStatusTemplate">
            <Border Background="{Binding IsActive, Converter={StaticResource ActiveStatusToColorConverter}}" 
                    CornerRadius="12" Padding="8,4" Margin="2">
                <TextBlock Text="{Binding IsActive, Converter={StaticResource ActiveStatusToTextConverter}}" 
                          Foreground="White" 
                          FontSize="11" 
                          FontWeight="SemiBold" 
                          HorizontalAlignment="Center"/>
            </Border>
        </DataTemplate>

        <!-- Route Assignment Template -->
        <DataTemplate x:Key="AssignmentTemplate">
            <StackPanel Orientation="Horizontal">
                <Border Background="#E3F2FD" CornerRadius="4" Padding="6,3" Margin="0,0,4,0">
                    <TextBlock Text="{Binding BusNumber}" FontSize="10" FontWeight="SemiBold" Foreground="#1976D2"/>
                </Border>
                <TextBlock Text="|" VerticalAlignment="Center" Margin="2,0" Foreground="#BDBDBD"/>
                <Border Background="#F3E5F5" CornerRadius="4" Padding="6,3" Margin="4,0,0,0">
                    <TextBlock Text="{Binding DriverName}" FontSize="10" FontWeight="SemiBold" Foreground="#7B1FA2"/>
                </Border>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <!-- Enhanced Route Management with Syncfusion DockingManager -->
    <sf:DockingManager UseDocumentContainer="True" PersistState="False" ContainerMode="TDI">
        
        <!-- Main Route Overview (Document) -->
        <ContentControl sf:DockingManager.Header="Route Network Overview" 
                       sf:DockingManager.State="Document"
                       sf:DockingManager.CanSerialize="True">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Enhanced Header with Route Analytics -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Route Management" FontSize="22" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- Search and Filter Panel -->
                        <StackPanel Orientation="Horizontal">
                            <sf:SfTextBoxExt x:Name="RouteSearchBox" 
                                           Watermark="Search routes..." 
                                           Width="250" 
                                           Height="32"
                                           Margin="0,0,10,0"/>
                            <Button Content="ðŸ”" 
                                    Command="{Binding SearchRoutesCommand}" 
                                    CommandParameter="{Binding Text, ElementName=RouteSearchBox}"
                                    Width="40" Height="32" Margin="0,0,10,0"/>
                            <syncfusion:ComboBoxAdv ItemsSource="{Binding AvailableRouteFilters}" 
                SelectedItem="{Binding SelectedRouteFilter}"
                DisplayMemberPath="Name"
                DefaultText="Filter routes..."
                Width="150" Height="32" Margin="0,0,10,0"/>
                            <CheckBox Content="Show Inactive" 
                                      IsChecked="{Binding ShowInactiveRoutes}"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Route Statistics Dashboard -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Border Background="#E8F5E8" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Active Routes" FontSize="12" Foreground="#2E7D32"/>
                                <TextBlock Text="{Binding ActiveRouteCount}" FontSize="20" FontWeight="Bold" Foreground="#2E7D32"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#E3F2FD" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Total Coverage" FontSize="12" Foreground="#1976D2"/>
                                <TextBlock Text="{Binding TotalCoveragePercentage, StringFormat='{}{0:F1}%'}" FontSize="20" FontWeight="Bold" Foreground="#1976D2"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#FFF3E0" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Assignments" FontSize="12" Foreground="#F57C00"/>
                                <TextBlock Text="{Binding AssignmentCompletionPercentage, StringFormat='{}{0:F1}%'}" FontSize="20" FontWeight="Bold" Foreground="#F57C00"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Enhanced Hierarchical Route Grid with TreeGrid -->
                <sf:SfTreeGrid Grid.Row="1"
                               ItemsSource="{Binding RouteHierarchy}"
                               ChildPropertyName="Assignments"
                               AutoGenerateColumns="False"
                               AllowResizingColumns="True"
                               AllowSorting="True"
                               AllowFiltering="True"
                               AllowEditing="True"
                               ColumnSizer="Star"
                               SelectionMode="Single"
                               NavigationMode="Row"
                               ShowRowHeader="True"
                               BorderThickness="1"
                               BorderBrush="#DDDDDD"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Stretch"
                               ExpanderColumn="RouteName"
                               AutoExpandMode="RootNodesExpanded">
                    
                    <sf:SfTreeGrid.Columns>
                        <!-- Route Name Column (Expandable) -->
                        <sf:TreeGridTextColumn MappingName="RouteName" HeaderText="Route Name" Width="200"/>
                        
                        <!-- Route Description -->
                        <sf:TreeGridTextColumn MappingName="Description" HeaderText="Description" Width="250"/>
                        
                        <!-- Active Status with Visual Indicator -->
                        <sf:TreeGridTemplateColumn MappingName="IsActive" HeaderText="Status" Width="100">
                            <sf:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource RouteStatusTemplate}"/>
                                </DataTemplate>
                            </sf:TreeGridTemplateColumn.CellTemplate>
                        </sf:TreeGridTemplateColumn>
                        
                        <!-- AM Assignment with Enhanced Display -->
                        <sf:TreeGridTemplateColumn MappingName="AMAssignment" HeaderText="AM Assignment" Width="200">
                            <sf:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="#E8F5E8" CornerRadius="4" Padding="6,3" Margin="0,0,4,0"
                                               Visibility="{Binding AMBusNumber, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding AMBusNumber, StringFormat='Bus {0}'}" 
                                                      FontSize="10" FontWeight="SemiBold" Foreground="#2E7D32"/>
                                        </Border>
                                        <Border Background="#F3E5F5" CornerRadius="4" Padding="6,3"
                                               Visibility="{Binding AMDriverName, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding AMDriverName}" 
                                                      FontSize="10" FontWeight="SemiBold" Foreground="#7B1FA2"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </sf:TreeGridTemplateColumn.CellTemplate>
                        </sf:TreeGridTemplateColumn>
                        
                        <!-- PM Assignment with Enhanced Display -->
                        <sf:TreeGridTemplateColumn MappingName="PMAssignment" HeaderText="PM Assignment" Width="200">
                            <sf:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="#E3F2FD" CornerRadius="4" Padding="6,3" Margin="0,0,4,0"
                                               Visibility="{Binding PMBusNumber, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding PMBusNumber, StringFormat='Bus {0}'}" 
                                                      FontSize="10" FontWeight="SemiBold" Foreground="#1976D2"/>
                                        </Border>
                                        <Border Background="#FFF3E0" CornerRadius="4" Padding="6,3"
                                               Visibility="{Binding PMDriverName, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding PMDriverName}" 
                                                      FontSize="10" FontWeight="SemiBold" Foreground="#F57C00"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </sf:TreeGridTemplateColumn.CellTemplate>
                        </sf:TreeGridTemplateColumn>
                        
                        <!-- Route Efficiency -->
                        <sf:TreeGridTemplateColumn MappingName="Efficiency" HeaderText="Efficiency" Width="120">
                            <sf:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ProgressBar Value="{Binding EfficiencyScore}" 
                                                    Minimum="0"
                                                    Maximum="100" 
                                                    Width="60" 
                                                    Height="8" 
                                                    Foreground="{Binding EfficiencyScore, Converter={StaticResource EfficiencyToColorConverter}}"
                                                    Background="#E0E0E0"
                                                    Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding EfficiencyScore, StringFormat='{}{0:F0}%'}" 
                                                  FontSize="11" FontWeight="SemiBold"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </sf:TreeGridTemplateColumn.CellTemplate>
                        </sf:TreeGridTemplateColumn>
                        
                        <!-- Student Count -->
                        <sf:TreeGridNumericColumn MappingName="StudentCount" HeaderText="Students" Width="80"/>
                        
                        <!-- Last Updated -->
                        <sf:TreeGridDateTimeColumn MappingName="LastUpdated" HeaderText="Last Updated" Width="120" Pattern="ShortDate"/>
                    </sf:SfTreeGrid.Columns>

                    <!-- Enhanced Row Styling -->
                    <sf:SfTreeGrid.Style>
                        <Style TargetType="sf:SfTreeGrid">
                            <Setter Property="Background" Value="White"/>
                            <Setter Property="GridLinesVisibility" Value="Both"/>
                            <Setter Property="HeaderLinesVisibility" Value="Both"/>
                        </Style>
                    </sf:SfTreeGrid.Style>
                    
                    <!-- Context Menu for Route Operations -->
                    <sf:SfTreeGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="View Route Details" Command="{Binding ViewRouteDetailsCommand}"/>
                            <MenuItem Header="Edit Route" Command="{Binding EditRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Assign Resources" Command="{Binding AssignResourcesCommand}"/>
                            <MenuItem Header="Optimize Route" Command="{Binding OptimizeRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Duplicate Route" Command="{Binding DuplicateRouteCommand}"/>
                            <MenuItem Header="Export Route Data" Command="{Binding ExportRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Deactivate Route" Command="{Binding DeactivateRouteCommand}" 
                                     Foreground="Orange"/>
                            <MenuItem Header="Delete Route" Command="{Binding DeleteRouteCommand}" 
                                     Foreground="Red"/>
                        </ContextMenu>
                    </sf:SfTreeGrid.ContextMenu>
                </sf:SfTreeGrid>

                <!-- Enhanced Action Panel -->
                <Grid Grid.Row="2" Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Route Summary Information -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Showing" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock Text="{Binding Routes.Count, Mode=OneWay}" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="of" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBlock Text="{Binding TotalRoutes, Mode=OneWay}" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="routes" VerticalAlignment="Center" Margin="5,0,15,0"/>
                        
                        <!-- Assignment Status Indicator -->
                        <Border Background="#E8F5E8" CornerRadius="4" Padding="8,4" Margin="0,0,10,0">
                            <TextBlock Text="{Binding FullyAssignedCount, StringFormat='{}{0} fully assigned'}" 
                                      Foreground="#2E7D32" FontWeight="SemiBold"/>
                        </Border>
                        <Border Background="#FFF3E0" CornerRadius="4" Padding="8,4">
                            <TextBlock Text="{Binding PartiallyAssignedCount, StringFormat='{}{0} need assignment'}" 
                                      Foreground="#F57C00" FontWeight="SemiBold"/>
                        </Border>
                    </StackPanel>
                    
                    <!-- Action Buttons with Enhanced Styling -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="âž• Add Route" 
                                Command="{Binding AddRouteCommand}" 
                                Style="{StaticResource PrimaryButtonStyle}"
                                Width="120" Height="36" 
                                Margin="5,0"/>
                        <Button Content="âœï¸ Edit" 
                                Command="{Binding UpdateRouteCommand}" 
                                   CommandParameter="{Binding SelectedRoute}"
                                   Style="{StaticResource SecondaryButtonStyle}"
                                   Width="80" Height="36" 
                                   Margin="5,0"/>
                        <Button Content="ðŸ”„ Optimize" 
                                Command="{Binding OptimizeAllRoutesCommand}" 
                                Style="{StaticResource AccentButtonStyle}"
                                Width="100" Height="36" 
                                Margin="5,0"/>
                        <Button Content="ðŸ”§ Tools" 
                                Width="100" Height="36" 
                                Margin="5,0">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Auto-Assign Resources" 
                                             Command="{Binding AutoAssignResourcesCommand}"/>
                                    <MenuItem Header="Validate Assignments" 
                                             Command="{Binding ValidateAssignmentsCommand}"/>
                                    <Separator/>
                                    <MenuItem Header="Import Routes" 
                                             Command="{Binding ImportRoutesCommand}"/>
                                    <MenuItem Header="Export Routes" 
                                             Command="{Binding ExportRoutesCommand}"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                        <Button Content="ðŸ—‘ï¸ Delete" 
                                Command="{Binding DeleteRouteCommand}" 
                                CommandParameter="{Binding SelectedRoute}"
                                Style="{StaticResource DangerButtonStyle}"
                                Width="80" Height="36" 
                                Margin="5,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </ContentControl>

        <!-- Resource Assignment Panel (Docked Right) -->
        <ContentControl sf:DockingManager.Header="Resource Assignment" 
                       sf:DockingManager.State="Dock"
                       sf:DockingManager.SideInDockedMode="Right"
                       sf:DockingManager.DesiredWidthInDockedMode="400"
                       sf:DockingManager.CanSerialize="True">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Assignment Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                    <TextBlock Text="Quick Assignment" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Drag and drop or use quick assign to manage route resources." 
                              FontSize="12" Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,10"/>
                </StackPanel>
                
                <!-- Quick Assignment Controls -->
                <Grid Grid.Row="1" Margin="0,0,0,15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Route Selection -->
                    <TextBlock Grid.Row="0" Text="Selected Route:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <syncfusion:ComboBoxAdv Grid.Row="1" 
                ItemsSource="{Binding Routes}" 
                SelectedItem="{Binding SelectedRouteForAssignment}"
                DisplayMemberPath="RouteName"
                DefaultText="Select a route..."
                Height="32" Margin="0,0,0,10"/>
                    
                    <!-- Time Period Selection -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                        <RadioButton Content="AM" IsChecked="{Binding IsAMAssignment}" Margin="0,0,15,0"/>
                        <RadioButton Content="PM" IsChecked="{Binding IsPMAssignment}"/>
                    </StackPanel>
                    
                    <!-- Assignment Controls -->
                    <Grid Grid.Row="3">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Bus:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <syncfusion:ComboBoxAdv Grid.Row="1" 
                ItemsSource="{Binding AvailableBuses}" 
                SelectedItem="{Binding SelectedBusForAssignment}"
                DisplayMemberPath="BusNumber"
                DefaultText="Select bus..."
                Height="32" Margin="0,0,0,8"/>
                        
                        <TextBlock Grid.Row="2" Text="Driver:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <syncfusion:ComboBoxAdv Grid.Row="3" 
                ItemsSource="{Binding AvailableDrivers}" 
                SelectedItem="{Binding SelectedDriverForAssignment}"
                DisplayMemberPath="FullName"
                DefaultText="Select driver..."
                Height="32"/>
                    </Grid>
                </Grid>
                
                <!-- Available Resources -->
                <TabControl Grid.Row="2" BorderThickness="1" BorderBrush="#E0E0E0">
                    <TabItem Header="Available Buses">
                        <ListBox ItemsSource="{Binding UnassignedBuses}" 
                                    SelectedItem="{Binding SelectedUnassignedBus}"
                                    DisplayMemberPath="BusNumber"
                                    SelectionMode="Single"
                                    AllowDrop="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#E3F2FD" CornerRadius="4" Padding="8,6" Margin="2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="ðŸšŒ" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{Binding BusNumber, StringFormat='Bus #{0}'}" FontWeight="SemiBold"/>
                                                <TextBlock FontSize="11" Foreground="#666">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="{}{0} {1}">
                                                            <Binding Path="Make"/>
                                                            <Binding Path="Model"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>
                                            <TextBlock Grid.Column="2" Text="{Binding SeatingCapacity, StringFormat='{}{0} seats'}" 
                                                      FontSize="11" Foreground="#1976D2" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    
                    <TabItem Header="Available Drivers">
                        <ListBox ItemsSource="{Binding UnassignedDrivers}" 
                                    SelectedItem="{Binding SelectedUnassignedDriver}"
                                    SelectionMode="Single"
                                    AllowDrop="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F3E5F5" CornerRadius="4" Padding="8,6" Margin="2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="ðŸ‘¨â€ðŸ’¼" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{Binding FullName}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding ContactPhone}" FontSize="11" Foreground="#666"/>
                                            </StackPanel>
                                            <Ellipse Grid.Column="2" Width="12" Height="12" 
                                                   Fill="{Binding IsAvailable, Converter={StaticResource AvailabilityToColorConverter}}" 
                                                   VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                </TabControl>
                
                <!-- Assignment Actions -->
                <StackPanel Grid.Row="3" Margin="0,15,0,0">
                    <Button Content="âœ… Assign Selected" 
                            Command="{Binding AssignResourcesCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Height="36" Margin="0,0,0,8"/>
                    <Button Content="ðŸ”„ Auto-Assign All" 
                            Command="{Binding AutoAssignAllCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Height="32" Margin="0,0,0,8"/>
                    <Button Content="âŒ Clear Assignment" 
                            Command="{Binding ClearAssignmentCommand}"
                               Style="{StaticResource DangerButtonStyle}"
                               Height="32"/>
                </StackPanel>
            </Grid>
        </ContentControl>

        <!-- Route Analytics (Document Tab) -->
        <ContentControl sf:DockingManager.Header="Route Analytics" 
                       sf:DockingManager.State="Document"
                       sf:DockingManager.CanSerialize="True">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="300"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Analytics Header -->
                <TextBlock Grid.Row="0" Text="Route Performance Analytics" 
                          FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>
                
                <!-- Analytics Charts -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Route Efficiency Chart -->
                    <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" 
                           CornerRadius="6" Margin="0,0,10,0">
                        <sf:SfChart Header="Route Efficiency Trends" Margin="15">
                            <sf:SfChart.PrimaryAxis>
                                <sf:CategoryAxis Header="Routes"/>
                            </sf:SfChart.PrimaryAxis>
                            <sf:SfChart.SecondaryAxis>
                                <sf:NumericalAxis Header="Efficiency %"/>
                            </sf:SfChart.SecondaryAxis>
                            <sf:ColumnSeries ItemsSource="{Binding RouteEfficiencyData}" 
                                           XBindingPath="RouteName" 
                                           YBindingPath="EfficiencyScore"
                                           Interior="#2196F3"/>
                        </sf:SfChart>
                    </Border>
                    
                    <!-- Resource Utilization Pie Chart -->
                    <Border Grid.Column="1" BorderBrush="#E0E0E0" BorderThickness="1" 
                           CornerRadius="6" Margin="10,0,0,0">
                        <sf:SfChart Header="Resource Utilization" Margin="15">
                            <sf:PieSeries ItemsSource="{Binding ResourceUtilizationData}" 
                                        XBindingPath="Category" 
                                        YBindingPath="Value"
                                        ExplodeIndex="0"
                                        ExplodeRadius="10"/>
                        </sf:SfChart>
                    </Border>
                </Grid>
                
                <!-- Detailed Analytics Grid -->
                <sf:SfDataGrid Grid.Row="2" Margin="0,15,0,0"
                               ItemsSource="{Binding RouteAnalyticsData}"
                               AutoGenerateColumns="False"
                               AllowSorting="True"
                               AllowFiltering="True"
                               ShowRowHeader="False">
                    <sf:SfDataGrid.Columns>
                        <sf:GridTextColumn MappingName="RouteName" HeaderText="Route Name" Width="150"/>
                        <sf:GridNumericColumn MappingName="EfficiencyScore" HeaderText="Efficiency %" Width="100"/>
                        <sf:GridNumericColumn MappingName="StudentCount" HeaderText="Students" Width="80"/>
                        <sf:GridNumericColumn MappingName="DistanceKm" HeaderText="Distance (km)" Width="120"/>
                        <sf:GridNumericColumn MappingName="AverageTime" HeaderText="Avg Time (min)" Width="120"/>
                        <sf:GridTextColumn MappingName="ResourceUtilization" HeaderText="Resource Usage" Width="130"/>
                        <sf:GridDateTimeColumn MappingName="LastOptimized" HeaderText="Last Optimized" Width="130" Pattern="ShortDate"/>
                    </sf:SfDataGrid.Columns>
                </sf:SfDataGrid>
            </Grid>
        </ContentControl>

        <!-- Loading Indicator -->
        <Border sf:DockingManager.CanSerialize="False"
                Background="#80000000" 
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <sf:SfBusyIndicator IsBusy="True" 
                                   AnimationType="SingleCircle" 
                                   Foreground="White"
                                   Width="60" 
                                   Height="60"/>
                <TextBlock Text="Loading route data..." 
                           Foreground="White" 
                           FontSize="16" 
                           Margin="0,15,0,0" 
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </sf:DockingManager>
</UserControl>
