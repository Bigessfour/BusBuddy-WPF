<!--
╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                                                                                                          ║
║                                              🔒 BUSBUDDY SYNCFUSION THEME COMPLIANCE REFERENCE 🔒                                                                    ║
║                                                                                                                                                                          ║
║  📋 REQUIRED STANDARDS: This child form MUST follow the universal standards defined in:                                                                                ║
║     - BusBuddy.WPF\Resources\SyncfusionFluentDarkTheme.xaml (Universal Control Standards)                                                                             ║
║     - Documentation\SyncfusionThemeImplementationGuide.md (Implementation Guide)                                                                                       ║
║                                                                                                                                                                          ║
║  🔧 MANDATORY IMPLEMENTATIONS:                                                                                                                                          ║
║     ✅ UserControl Style: BusBuddyUserControlStyle                                                                                                                     ║
║     ✅ Button Controls: Use syncfusion:ButtonAdv with Label property (NOT Content)                                                                                    ║
║     ✅ Data Grid: Use syncfusion:SfDataGrid with BusBuddySfDataGridStyle                                                                                              ║
║     ✅ Input Controls: Use Syncfusion equivalents (ComboBoxAdv, TextBoxExt, etc.)                                                                                     ║
║     ✅ Theme Application:  on ALL Syncfusion controls                                                           ║
║     ✅ Color Palette: Use FluentDark brushes defined in SyncfusionFluentDarkTheme.xaml                                                                                ║
║                                                                                                                                                                          ║
║  ⚠️  CRITICAL REMINDERS:                                                                                                                                               ║
║     • NEVER use standard WPF Button - use syncfusion:ButtonAdv                                                                                                        ║
║     • NEVER use Content property on ButtonAdv - use Label property                                                                                                    ║
║     • NEVER use "sf:" namespace prefix - use "syncfusion:" prefix                                                                                                     ║
║     • ALWAYS apply FluentDark theme to maintain visual consistency                                                                                                     ║
║     • ALWAYS reference baseline styles for consistent appearance                                                                                                       ║
║                                                                                                                                                                          ║
║  📚 DEVELOPMENT REFERENCE: See Documentation\SyncfusionThemeImplementationGuide.md for copy-paste templates                                                          ║
║                                                                                                                                                                          ║
╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝
-->

<UserControl x:Class="BusBuddy.WPF.Views.Route.RouteManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:syncfusionskin="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
             xmlns:progressbar="clr-namespace:Syncfusion.UI.Xaml.ProgressBar;assembly=Syncfusion.SfProgressBar.WPF"
             xmlns:sf="http://schemas.syncfusion.com/wpf"
             xmlns:viewModels="clr-namespace:BusBuddy.WPF.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance viewModels:RouteManagementViewModel}"
                          >

    <UserControl.Resources>
        <!-- BooleanToVisibilityConverter is now global in App.xaml - removed duplicate -->

        <!-- Enhanced Route Status Templates -->
        <DataTemplate x:Key="RouteStatusTemplate">
            <Border Background="{Binding IsActive, Converter={StaticResource ActiveStatusToColorConverter}}"
                    CornerRadius="12" Padding="8,4" Margin="2">
                <TextBlock Text="{Binding IsActive, Converter={StaticResource ActiveStatusToTextConverter}}"
                          Foreground="White"
                          FontSize="11"
                          FontWeight="SemiBold"
                          HorizontalAlignment="Center"/>
            </Border>
        </DataTemplate>

        <!-- Route Assignment Template -->
        <DataTemplate x:Key="AssignmentTemplate">
            <StackPanel Orientation="Horizontal">
                <Border Background="#E3F2FD" CornerRadius="4" Padding="6,3" Margin="0,0,4,0">
                    <TextBlock Text="{Binding BusNumber}" FontSize="10" FontWeight="SemiBold" Foreground="#1976D2"/>
                </Border>
                <TextBlock Text="|" VerticalAlignment="Center" Margin="2,0" Foreground="#BDBDBD"/>
                <Border Background="#F3E5F5" CornerRadius="4" Padding="6,3" Margin="4,0,0,0">
                    <TextBlock Text="{Binding DriverName}" FontSize="10" FontWeight="SemiBold" Foreground="#7B1FA2"/>
                </Border>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <!-- Enhanced Route Management with Syncfusion DockingManager -->
    <syncfusion:DockingManager UseDocumentContainer="True"
                           PersistState="False"
                           ContainerMode="TDI"
                           Style="{StaticResource BusBuddyDockingManagerStyle}"
                           
                           Background="{DynamicResource ContentBackground}">

        <!-- Main Route Overview (Document) -->
        <ContentControl syncfusion:DockingManager.Header="Route Network Overview"
                       syncfusion:DockingManager.State="Document"
                       syncfusion:DockingManager.CanSerialize="True">
            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Enhanced Header with Route Analytics -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Route Management" FontSize="22" FontWeight="Bold" Margin="0,0,0,10"/>                            <!-- Search and Filter Panel -->
                            <StackPanel Orientation="Horizontal">
                                <syncfusion:SfTextBoxExt x:Name="RouteSearchBox"
                                               Watermark="Search routes..."
                                               Width="250"
                                               Height="32"
                                               
                                               Background="{DynamicResource SurfaceBackground}"
                                               Foreground="{DynamicResource PrimaryForeground}"
                                               BorderBrush="{DynamicResource BorderBrush}"
                                               Margin="0,0,10,0"/>                                <syncfusion:ButtonAdv Label="🔍"
                                              Command="{Binding SearchRoutesCommand}"
                                              CommandParameter="{Binding Text, ElementName=RouteSearchBox}"
                                              Style="{StaticResource BusBuddyIconButtonAdvStyle}"
                                              
                                              Width="40" Height="32"
                                              Margin="0,0,10,0"/>
                                <syncfusion:ComboBoxAdv ItemsSource="{Binding AvailableRouteFilters}"
                                            SelectedItem="{Binding SelectedRouteFilter}"
                                            DisplayMemberPath="Name"
                                            DefaultText="Filter routes..."
                                            Style="{StaticResource BusBuddyComboBoxAdvStyle}"
                                            
                                            Background="{DynamicResource SurfaceBackground}"
                                            Foreground="{DynamicResource PrimaryForeground}"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            Width="150" Height="32"
                                            Margin="0,0,10,0"/>
                            <CheckBox Content="Show Inactive"
                                      IsChecked="{Binding ShowInactiveRoutes}"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Route Statistics Dashboard -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Border Background="#E8F5E8" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Active Routes" FontSize="12" Foreground="#2E7D32"/>
                                <TextBlock Text="{Binding ActiveRouteCount}" FontSize="20" FontWeight="Bold" Foreground="#2E7D32"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#E3F2FD" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Total Coverage" FontSize="12" Foreground="#1976D2"/>
                                <TextBlock Text="{Binding TotalCoveragePercentage, StringFormat='{}{0:F1}%'}" FontSize="20" FontWeight="Bold" Foreground="#1976D2"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#FFF3E0" CornerRadius="8" Padding="12,8" Margin="5,0">
                            <StackPanel>
                                <TextBlock Text="Assignments" FontSize="12" Foreground="#F57C00"/>
                                <TextBlock Text="{Binding AssignmentCompletionPercentage, StringFormat='{}{0:F1}%'}" FontSize="20" FontWeight="Bold" Foreground="#F57C00"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Enhanced Hierarchical Route Grid with TreeGrid -->
                <syncfusion:SfTreeGrid Grid.Row="1"
                               ItemsSource="{Binding RouteHierarchy}"
                               ChildPropertyName="Assignments"
                               AutoGenerateColumns="False"
                               AllowResizingColumns="True"
                               AllowSorting="True"
                               AllowFiltering="True"
                               AllowEditing="True"
                               ColumnSizer="Star"
                               SelectionMode="Single"
                               NavigationMode="Row"
                               ShowRowHeader="True"
                               
                               Background="{DynamicResource ContentBackground}"
                               Foreground="{DynamicResource PrimaryForeground}"
                               BorderBrush="{DynamicResource BorderBrush}"
                               BorderThickness="1"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Stretch"
                               ExpanderColumn="RouteName"
                               AutoExpandMode="RootNodesExpanded">

                    <syncfusion:SfTreeGrid.Columns>
                        <!-- Route Name Column (Expandable) -->
                        <syncfusion:TreeGridTextColumn MappingName="RouteName" HeaderText="Route Name" Width="200"/>

                        <!-- Route Description -->
                        <syncfusion:TreeGridTextColumn MappingName="Description" HeaderText="Description" Width="250"/>

                        <!-- Active Status with Visual Indicator -->
                        <syncfusion:TreeGridTemplateColumn MappingName="IsActive" HeaderText="Status" Width="100">
                            <syncfusion:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource RouteStatusTemplate}"/>
                                </DataTemplate>
                            </syncfusion:TreeGridTemplateColumn.CellTemplate>
                        </syncfusion:TreeGridTemplateColumn>

                        <!-- AM Assignment with Enhanced Display -->
                        <syncfusion:TreeGridTemplateColumn MappingName="AMAssignment" HeaderText="AM Assignment" Width="200">
                            <syncfusion:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="{DynamicResource SuccessBackground}" Opacity="0.2" CornerRadius="4" Padding="6,3" Margin="0,0,4,0"
                                               Visibility="{Binding AMBusNumber, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding AMBusNumber, StringFormat='Bus {0}'}"
                                                      FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource SuccessForeground}"/>
                                        </Border>
                                        <Border Background="{DynamicResource AccentBackground}" Opacity="0.2" CornerRadius="4" Padding="6,3"
                                               Visibility="{Binding AMDriverName, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding AMDriverName}"
                                                      FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource AccentForeground}"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </syncfusion:TreeGridTemplateColumn.CellTemplate>
                        </syncfusion:TreeGridTemplateColumn>

                        <!-- PM Assignment with Enhanced Display -->
                        <syncfusion:TreeGridTemplateColumn MappingName="PMAssignment" HeaderText="PM Assignment" Width="200">
                            <syncfusion:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="{DynamicResource AccentBackground}" Opacity="0.2" CornerRadius="4" Padding="6,3" Margin="0,0,4,0"
                                               Visibility="{Binding PMBusNumber, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding PMBusNumber, StringFormat='Bus {0}'}"
                                                      FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource AccentForeground}"/>
                                        </Border>
                                        <Border Background="{DynamicResource WarningBackground}" Opacity="0.2" CornerRadius="4" Padding="6,3"
                                               Visibility="{Binding PMDriverName, Converter={StaticResource StringToVisibilityConverter}}">
                                            <TextBlock Text="{Binding PMDriverName}"
                                                      FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource WarningForeground}"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </syncfusion:TreeGridTemplateColumn.CellTemplate>
                        </syncfusion:TreeGridTemplateColumn>

                        <!-- Route Efficiency -->
                        <syncfusion:TreeGridTemplateColumn MappingName="Efficiency" HeaderText="Efficiency" Width="120">
                            <syncfusion:TreeGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <progressbar:SfLinearProgressBar Progress="{Binding EfficiencyScore}"
                                                               Style="{StaticResource BusBuddySfLinearProgressBarStyle}"
                                                               
                                                               Minimum="0"
                                                               Maximum="100"
                                                               Width="60"
                                                               Height="8"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding EfficiencyScore, StringFormat='{}{0:F0}%'}"
                                                  FontSize="11" FontWeight="SemiBold"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </syncfusion:TreeGridTemplateColumn.CellTemplate>
                        </syncfusion:TreeGridTemplateColumn>

                        <!-- Student Count -->
                        <syncfusion:TreeGridNumericColumn MappingName="StudentCount" HeaderText="Students" Width="80"/>

                        <!-- Last Updated -->
                        <syncfusion:TreeGridDateTimeColumn MappingName="LastUpdated" HeaderText="Last Updated" Width="120" Pattern="ShortDate"/>
                    </syncfusion:SfTreeGrid.Columns>

                    <!-- Remove hardcoded style -->
                    <syncfusion:SfTreeGrid.Style>
                        <Style TargetType="syncfusion:SfTreeGrid">
                            <Setter Property="Background" Value="{DynamicResource ContentBackground}"/>
                            <Setter Property="GridLinesVisibility" Value="Both"/>
                            <Setter Property="HeaderLinesVisibility" Value="Both"/>
                        </Style>
                    </syncfusion:SfTreeGrid.Style>

                    <!-- Context Menu for Route Operations -->
                    <syncfusion:SfTreeGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="View Route Details" Command="{Binding ViewRouteDetailsCommand}"/>
                            <MenuItem Header="Edit Route" Command="{Binding EditRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Assign Resources" Command="{Binding AssignResourcesCommand}"/>
                            <MenuItem Header="Optimize Route" Command="{Binding OptimizeRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Duplicate Route" Command="{Binding DuplicateRouteCommand}"/>
                            <MenuItem Header="Export Route Data" Command="{Binding ExportRouteCommand}"/>
                            <Separator/>
                            <MenuItem Header="Deactivate Route" Command="{Binding DeactivateRouteCommand}"
                                     Foreground="Orange"/>
                            <MenuItem Header="Delete Route" Command="{Binding DeleteRouteCommand}"
                                     Foreground="Red"/>
                        </ContextMenu>
                    </syncfusion:SfTreeGrid.ContextMenu>
                </syncfusion:SfTreeGrid>

                <!-- Enhanced Action Panel -->
                <Grid Grid.Row="2" Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Route Summary Information -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Showing" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBlock Text="{Binding Routes.Count, Mode=OneWay}" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="of" VerticalAlignment="Center" Margin="5,0"/>
                        <TextBlock Text="{Binding TotalRoutes, Mode=OneWay}" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="routes" VerticalAlignment="Center" Margin="5,0,15,0"/>

                        <!-- Assignment Status Indicator -->
                        <Border Background="#E8F5E8" CornerRadius="4" Padding="8,4" Margin="0,0,10,0">
                            <TextBlock Text="{Binding FullyAssignedCount, StringFormat='{}{0} fully assigned'}"
                                      Foreground="#2E7D32" FontWeight="SemiBold"/>
                        </Border>
                        <Border Background="#FFF3E0" CornerRadius="4" Padding="8,4">
                            <TextBlock Text="{Binding PartiallyAssignedCount, StringFormat='{}{0} need assignment'}"
                                      Foreground="#F57C00" FontWeight="SemiBold"/>
                        </Border>
                    </StackPanel>

                    <!-- Action Buttons with Enhanced Styling -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <syncfusion:ButtonAdv Label="➕ Add Route"
                                              Command="{Binding AddRouteCommand}"
                                              Style="{StaticResource BusBuddyPrimaryButtonAdvStyle}"
                                              
                                              Width="120" Height="36"
                                              Margin="5,0"/>
                        <syncfusion:ButtonAdv Label="✏️ Edit"
                                              Command="{Binding UpdateRouteCommand}"
                                              CommandParameter="{Binding SelectedRoute}"
                                              Style="{StaticResource BusBuddySecondaryButtonAdvStyle}"
                                              
                                              Width="80" Height="36"
                                              Margin="5,0"/>
                        <syncfusion:ButtonAdv Label="🔄 Optimize"
                                              Command="{Binding OptimizeAllRoutesCommand}"
                                              Style="{StaticResource BusBuddyPrimaryButtonAdvStyle}"
                                              
                                              Width="100" Height="36"
                                              Margin="5,0"/>
                        <syncfusion:ButtonAdv Label="🔧 Tools"
                                              Style="{StaticResource BusBuddySecondaryButtonAdvStyle}"
                                              
                                              Width="100" Height="36"
                                              Margin="5,0">
                            <syncfusion:ButtonAdv.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Auto-Assign Resources"
                                             Command="{Binding AutoAssignResourcesCommand}"/>
                                    <MenuItem Header="Validate Assignments"
                                             Command="{Binding ValidateAssignmentsCommand}"/>
                                    <Separator/>
                                    <MenuItem Header="Import Routes"
                                             Command="{Binding ImportRoutesCommand}"/>
                                    <MenuItem Header="Export Routes"
                                             Command="{Binding ExportRoutesCommand}"/>
                                </ContextMenu>
                            </syncfusion:ButtonAdv.ContextMenu>
                        </syncfusion:ButtonAdv>
                        <syncfusion:ButtonAdv Label="🗑️ Delete"
                                              Command="{Binding DeleteRouteCommand}"
                                              CommandParameter="{Binding SelectedRoute}"
                                              Style="{StaticResource BusBuddyDangerButtonAdvStyle}"
                                              
                                              Width="80" Height="36"
                                              Margin="5,0"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </ContentControl>

        <!-- Resource Assignment Panel (Docked Right) -->
        <ContentControl syncfusion:DockingManager.Header="Resource Assignment"
                       syncfusion:DockingManager.State="Dock"
                       syncfusion:DockingManager.SideInDockedMode="Right"
                       syncfusion:DockingManager.DesiredWidthInDockedMode="400"
                       syncfusion:DockingManager.CanSerialize="True">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Assignment Header -->
                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                    <TextBlock Text="Quick Assignment" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="Drag and drop or use quick assign to manage route resources."
                              FontSize="12" Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,10"/>
                </StackPanel>

                <!-- Quick Assignment Controls -->
                <Grid Grid.Row="1" Margin="0,0,0,15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Route Selection -->
                    <TextBlock Grid.Row="0" Text="Selected Route:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <syncfusion:ComboBoxAdv Grid.Row="1"
                                        ItemsSource="{Binding Routes}"
                                        SelectedItem="{Binding SelectedRouteForAssignment}"
                                        DisplayMemberPath="RouteName"
                                        DefaultText="Select a route..."
                                        Style="{StaticResource BusBuddyComboBoxAdvStyle}"
                                        
                                        Background="{DynamicResource SurfaceBackground}"
                                        Foreground="{DynamicResource PrimaryForeground}"
                                        BorderBrush="{DynamicResource BorderBrush}"
                                        Height="32"
                                        Margin="0,0,0,10"/>

                    <!-- Time Period Selection -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                        <RadioButton Content="AM" IsChecked="{Binding IsAMAssignment}" Margin="0,0,15,0"/>
                        <RadioButton Content="PM" IsChecked="{Binding IsPMAssignment}"/>
                    </StackPanel>

                    <!-- Assignment Controls -->
                    <Grid Grid.Row="3">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Bus:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <syncfusion:ComboBoxAdv Grid.Row="1"
                                            ItemsSource="{Binding AvailableBuses}"
                                            SelectedItem="{Binding SelectedBusForAssignment}"
                                            DisplayMemberPath="BusNumber"
                                            DefaultText="Select bus..."
                                            Style="{StaticResource BusBuddyComboBoxAdvStyle}"
                                            
                                            Background="{DynamicResource SurfaceBackground}"
                                            Foreground="{DynamicResource PrimaryForeground}"
                                            BorderBrush="{DynamicResource BorderBrush}"
                                            Height="32"
                                            Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="2" Text="Driver:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <syncfusion:ComboBoxAdv Grid.Row="3"
                                            ItemsSource="{Binding AvailableDrivers}"
                                            SelectedItem="{Binding SelectedDriverForAssignment}"
                                            DisplayMemberPath="FullName"
                                            DefaultText="Select driver..."
                                            Style="{StaticResource BusBuddyComboBoxAdvStyle}"
                                            
                                            Background="{StaticResource ContentBackground}"
                                            Foreground="{StaticResource PrimaryForeground}"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            Height="32"/>
                    </Grid>
                </Grid>

                <!-- Available Resources -->
                <TabControl Grid.Row="2" BorderThickness="1" BorderBrush="#E0E0E0">
                    <TabItem Header="Available Buses">
                        <ListBox ItemsSource="{Binding UnassignedBuses}"
                                    SelectedItem="{Binding SelectedUnassignedBus}"
                                    SelectionMode="Single"
                                    AllowDrop="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#E3F2FD" CornerRadius="4" Padding="8,6" Margin="2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="🚌" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{Binding BusNumber, StringFormat='Bus #{0}'}" FontWeight="SemiBold"/>
                                                <TextBlock FontSize="11" Foreground="#666">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="{}{0} {1}">
                                                            <Binding Path="Make"/>
                                                            <Binding Path="Model"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>
                                            <TextBlock Grid.Column="2" Text="{Binding SeatingCapacity, StringFormat='{}{0} seats'}"
                                                      FontSize="11" Foreground="#1976D2" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>

                    <TabItem Header="Available Drivers">
                        <ListBox ItemsSource="{Binding UnassignedDrivers}"
                                    SelectedItem="{Binding SelectedUnassignedDriver}"
                                    SelectionMode="Single"
                                    AllowDrop="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F3E5F5" CornerRadius="4" Padding="8,6" Margin="2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="👨‍💼" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{Binding FullName}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding ContactPhone}" FontSize="11" Foreground="#666"/>
                                            </StackPanel>
                                            <Ellipse Grid.Column="2" Width="12" Height="12"
                                                   Fill="{Binding IsAvailable, Converter={StaticResource AvailabilityToColorConverter}}"
                                                   VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                </TabControl>

                <!-- Assignment Actions -->
                <StackPanel Grid.Row="3" Margin="0,15,0,0">
                    <syncfusion:ButtonAdv Label="✅ Assign Selected"
                                      Command="{Binding AssignResourcesCommand}"
                                      Style="{StaticResource BusBuddyPrimaryButtonAdvStyle}"
                                      
                                      Height="36"
                                      Margin="0,0,0,8"/>
                    <syncfusion:ButtonAdv Label="🔄 Auto-Assign All"
                                      Command="{Binding AutoAssignAllCommand}"
                                      Style="{StaticResource BusBuddySecondaryButtonAdvStyle}"
                                      
                                      Height="32"
                                      Margin="0,0,0,8"/>
                    <syncfusion:ButtonAdv Label="❌ Clear Assignment"
                                      Command="{Binding ClearAssignmentCommand}"
                                      Style="{StaticResource BusBuddyDangerButtonAdvStyle}"
                                      
                                      Height="32"/>
                </StackPanel>
            </Grid>
        </ContentControl>

        <!-- Route Analytics (Document Tab) -->
        <ContentControl syncfusion:DockingManager.Header="Route Analytics"
                       syncfusion:DockingManager.State="Document"
                       syncfusion:DockingManager.CanSerialize="True">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="300"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Analytics Header -->
                <TextBlock Grid.Row="0" Text="Route Performance Analytics"
                          FontSize="18" FontWeight="Bold" Margin="0,0,0,15"/>

                <!-- Analytics Charts -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Route Efficiency Chart -->
                    <Border Grid.Column="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                           CornerRadius="6" Margin="0,0,10,0">
                        <syncfusion:SfChart Header="Route Efficiency Trends"
                                          
                                          Background="{StaticResource ContentBackground}"
                                          Foreground="{StaticResource PrimaryForeground}"
                                          Margin="15">
                            <syncfusion:SfChart.PrimaryAxis>
                                <syncfusion:CategoryAxis Header="Routes"/>
                            </syncfusion:SfChart.PrimaryAxis>
                            <syncfusion:SfChart.SecondaryAxis>
                                <syncfusion:NumericalAxis Header="Efficiency %"/>
                            </syncfusion:SfChart.SecondaryAxis>
                            <syncfusion:ColumnSeries ItemsSource="{Binding RouteEfficiencyData}"
                                           XBindingPath="RouteName"
                                           YBindingPath="EfficiencyScore"
                                           Interior="{StaticResource AccentBrush}"/>
                        </syncfusion:SfChart>
                    </Border>

                    <!-- Resource Utilization Pie Chart -->
                    <Border Grid.Column="1" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                           CornerRadius="6" Margin="10,0,0,0">
                        <syncfusion:SfChart Header="Resource Utilization"
                                          
                                          Background="{StaticResource ContentBackground}"
                                          Foreground="{StaticResource PrimaryForeground}"
                                          Margin="15">
                            <syncfusion:PieSeries ItemsSource="{Binding ResourceUtilizationData}"
                                        XBindingPath="Category"
                                        YBindingPath="Value"
                                        ExplodeIndex="0"
                                        ExplodeRadius="10"/>
                        </syncfusion:SfChart>
                    </Border>
                </Grid>

                <!-- Detailed Analytics Grid -->
                <syncfusion:SfDataGrid Grid.Row="2" Margin="0,15,0,0"
                                   ItemsSource="{Binding RouteAnalyticsData}"
                                   Style="{StaticResource BusBuddySfDataGridStyle}"
                                   
                                   Background="{StaticResource ContentBackground}"
                                   Foreground="{StaticResource PrimaryForeground}"
                                   BorderBrush="{StaticResource BorderBrush}"
                                   AutoGenerateColumns="False"
                                   AllowSorting="True"
                                   AllowFiltering="True"
                                   ShowRowHeader="False">
                    <syncfusion:SfDataGrid.Columns>
                        <syncfusion:GridTextColumn MappingName="RouteName" HeaderText="Route Name" Width="150"/>
                        <syncfusion:GridNumericColumn MappingName="EfficiencyScore" HeaderText="Efficiency %" Width="100"/>
                        <syncfusion:GridNumericColumn MappingName="StudentCount" HeaderText="Students" Width="80"/>
                        <syncfusion:GridNumericColumn MappingName="DistanceKm" HeaderText="Distance (km)" Width="120"/>
                        <syncfusion:GridNumericColumn MappingName="AverageTime" HeaderText="Avg Time (min)" Width="120"/>
                        <syncfusion:GridTextColumn MappingName="ResourceUtilization" HeaderText="Resource Usage" Width="130"/>
                        <syncfusion:GridDateTimeColumn MappingName="LastOptimized" HeaderText="Last Optimized" Width="130" Pattern="ShortDate"/>
                    </syncfusion:SfDataGrid.Columns>
                </syncfusion:SfDataGrid>
            </Grid>
        </ContentControl>

        <!-- Loading Indicator -->
        <syncfusion:SfBusyIndicator syncfusion:DockingManager.CanSerialize="False"
                                IsBusy="{Binding IsBusy}"
                                Style="{StaticResource BusBuddySfBusyIndicatorStyle}"
                                
                                AnimationType="DoubleCircle"
                                Foreground="{StaticResource AccentBrush}"
                                Background="Transparent"/>
    </syncfusion:DockingManager>
</UserControl>


